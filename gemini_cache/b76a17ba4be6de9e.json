{
  "timestamp": 1769070743.3807979,
  "response": "[\n  {\n    \"file_path\": \"h2q_project/evolution_system.py\",\n    \"content\": \"import docker\\nimport os\\nimport time\\nimport logging\\n\\nlogger = logging.getLogger(__name__)\\n\\nclass EvolutionSystem:\\n    def __init__(self, image_name, cpu_limit=None, memory_limit=None):\\n        self.client = docker.from_env()\\n        self.image_name = image_name\\n        self.cpu_limit = cpu_limit\\n        self.memory_limit = memory_limit\\n        self.container = None\\n\\n    def run_task(self, command):\\n        # Define resource limits\\n        resources = {}\\n        if self.cpu_limit:\\n            resources['cpu_period'] = 100000  # Required for cpu_quota\\n            resources['cpu_quota'] = int(self.cpu_limit * 100000)\\n        if self.memory_limit:\\n            resources['mem_limit'] = self.memory_limit\\n\\n        try:\\n            self.container = self.client.containers.run(\\n                self.image_name, \\n                command, \\n                detach=True, \\n                **resources\\n            )\\n            logger.info(f\\\"Container started with ID: {self.container.id}\\\")\\n\\n            # Monitor memory usage (example, adjust as needed)\\n            start_time = time.time()\\n            while self.container.status != 'exited' and time.time() - start_time < 300: # Timeout after 5 minutes\\n                stats = self.container.stats(stream=False)\\n                memory_usage = stats['memory_stats']['usage']\\n                memory_limit = stats['memory_stats']['limit']\\n\\n                logger.debug(f\\\"Memory Usage: {memory_usage}, Limit: {memory_limit}\\\")\\n\\n                if self.memory_limit and memory_usage > 0.9 * memory_limit: # 90% threshold\\n                    logger.warning(\\\"Approaching memory limit. Attempting to clean resources...\\\")\\n                    self.clean_resources() # Implement your resource cleaning logic\\n                    # Consider adjusting the task or retrying\\n\\n                self.container.reload() # Update container status\\n                time.sleep(5)\\n\\n            if self.container.status != 'exited':\\n                logger.warning(\\\"Container timed out or still running. Stopping...\\\")\\n                self.container.stop()\\n\\n            result = self.container.logs().decode('utf-8')\\n            self.container.remove()\\n            return result\\n\\n        except docker.errors.APIError as e:\\n            logger.error(f\\\"Docker API Error: {e}\\\")\\n            if self.container:\\n                self.container.remove()\\n            return None\\n        except Exception as e:\\n            logger.error(f\\\"An unexpected error occurred: {e}\\\")\\n            if self.container:\\n                self.container.remove()\\n            return None\\n\\n    def clean_resources(self):\\n        # Implement your resource cleaning logic here\\n        # For example, delete temporary files, stop unused processes, etc.\\n        logger.info(\\\"Cleaning up resources...\\\")\\n        # Placeholder: Add your resource cleaning code here\\n        pass\\n\\n    def stop_container(self):\\n        if self.container:\\n            try:\\n                self.container.stop()\\n                self.container.remove()\\n                logger.info(f\\\"Container {self.container.id} stopped and removed.\\\")\\n            except docker.errors.APIError as e:\\n                logger.error(f\\\"Error stopping container: {e}\\\")\\n            except Exception as e:\\n                logger.error(f\\\"An unexpected error occurred while stopping container: {e}\\\")\\n\\nif __name__ == '__main__':\\n    # Example Usage\\n    logging.basicConfig(level=logging.DEBUG)\\n    evolution_system = EvolutionSystem(image_name='ubuntu:latest', cpu_limit=0.5, memory_limit='512m')\\n    try:\\n        result = evolution_system.run_task(command='echo Hello, World!')\\n        print(f\\\"Task Result: {result}\\\")\\n    finally:\\n        evolution_system.stop_container()\\n\"\n  }\n]",
  "model": "gemini-2.0-flash"
}