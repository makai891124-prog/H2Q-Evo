# H2Q AGI 24小时自主进化系统指南

## 📋 概述

H2Q AGI 24小时自主进化系统是一个完全自主的学习和进化框架，具有以下核心特性：

1. **基于兴趣的自主学习** - 系统根据兴趣主题自动获取知识
2. **网络公开资源轮询** - 通过Wikipedia API安全获取学习资料
3. **分形压缩记忆管理** - 使用分形理论进行数据压缩，优化存储
4. **进程监控与心跳机制** - 防止假死，自动重启恢复
5. **标准能力测试** - 可外部比较的人类测试基准

## 🚀 快速启动

### 1. 环境要求

```bash
# Python 3.10+
python3 --version

# 安装依赖
pip install numpy requests
```

### 2. 运行选项

```bash
cd /Users/imymm/H2Q-Evo

# 完整24小时进化
PYTHONPATH=. python3 start_24h_evolution.py

# 5分钟快速测试
PYTHONPATH=. python3 start_24h_evolution.py --quick

# 自定义时长（例如1小时）
PYTHONPATH=. python3 start_24h_evolution.py --hours 1

# 后台运行24小时进化
nohup python3 start_24h_evolution.py > evolution_output.log 2>&1 &
```

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────┐
│                 start_24h_evolution.py                   │
│                   (主启动脚本)                            │
└─────────────────┬───────────────────┬───────────────────┘
                  │                   │
    ┌─────────────▼─────────┐   ┌─────▼────────────────┐
    │   SurvivalDaemon      │   │  Evolution24HSystem   │
    │   (生存守护进程)        │   │  (24小时进化系统)      │
    │                       │   │                       │
    │ ┌───────────────────┐ │   │ ┌─────────────────┐   │
    │ │ 心跳循环 (10秒)    │ │   │ │ FractalCompressor│   │
    │ └───────────────────┘ │   │ │ (分形压缩器)     │   │
    │ ┌───────────────────┐ │   │ └─────────────────┘   │
    │ │ 监控循环 (30秒)    │ │   │ ┌─────────────────┐   │
    │ └───────────────────┘ │   │ │ KnowledgeAcquirer│   │
    │ ┌───────────────────┐ │   │ │ (知识获取器)     │   │
    │ │ 自动重启机制       │ │   │ └─────────────────┘   │
    │ └───────────────────┘ │   │ ┌─────────────────┐   │
    └───────────────────────┘   │ │ CapabilityTester │   │
                                │ │ (能力测试器)     │   │
                                │ └─────────────────┘   │
                                └───────────────────────┘
```

## 🔬 核心组件

### 1. 生存守护进程 (SurvivalDaemon)

- **心跳机制**: 每10秒发送心跳信号
- **监控循环**: 每30秒检查进程状态
- **自动重启**: 最多5次重启尝试
- **能力认证**: 定期进行能力测试反馈

### 2. 分形压缩器 (FractalCompressor)

- **压缩比**: 约50%
- **算法**: 基于分形采样和黄金分割分布
- **用途**: 释放内存和存储空间限制

### 3. 知识获取器 (KnowledgeAcquirer)

- **数据源**: Wikipedia REST API
- **模式**: 本地轮询，非实时下载
- **安全**: 遵循robots.txt，设置User-Agent

### 4. 能力测试器 (CapabilityTester)

| 测试类别 | 内容 |
|----------|------|
| 数学 (math) | 基础运算、代数、几何 |
| 逻辑 (logic) | 三段论推理、蕴涵判断 |
| 模式 (pattern) | 序列预测、规律识别 |
| 记忆 (memory) | 短期记忆回溯 |

**评分等级**:
- 90%+ : 优秀 (Excellent)
- 80-90%: 良好 (Good)
- 60-80%: 及格 (Pass)
- <60%: 需要改进 (Needs Improvement)

## 📊 进化周期

```
┌──────────────────────────────────────────────────────────┐
│                     24小时进化循环                         │
│                                                          │
│  ┌─────────┐   ┌─────────┐   ┌─────────┐   ┌─────────┐  │
│  │ 学习周期 │──▶│ 知识压缩 │──▶│ 能力测试 │──▶│ 心跳认证 │  │
│  │ (30分钟) │   │         │   │ (60分钟) │   │ (10秒)  │  │
│  └─────────┘   └─────────┘   └─────────┘   └─────────┘  │
│       │                                          │       │
│       └──────────────────────────────────────────┘       │
│                     循环直到24小时                         │
└──────────────────────────────────────────────────────────┘
```

## 📁 输出文件

| 文件 | 说明 |
|------|------|
| `EVOLUTION_24H_REPORT.md` | 进化过程报告 |
| `EVOLUTION_ACCEPTANCE_REPORT.md` | 最终验收报告 |
| `evolution_24h_state.json` | 进化状态存档 |
| `survival_daemon_state.json` | 守护进程状态 |
| `evolution.log` | 详细运行日志 |

## 🧪 测试结果示例

**5分钟快速测试结果** (2026-01-22):

```
验收摘要
============================================================
  运行时间: 0.06 小时
  学习周期: 15
  知识条目: 8
  最终评分: 91.7%
  验收状态: ✅ 通过
============================================================

能力评分:
- 数学: 100.0% ✅
- 逻辑: 66.7% ✅
- 模式: 100.0% ✅
- 记忆: 100.0% ✅
```

## 🛡️ 安全特性

1. **网络安全**: 仅访问公开Wikipedia API
2. **资源限制**: 分形压缩控制内存使用
3. **进程保护**: 心跳监控防止假死
4. **优雅退出**: 支持Ctrl+C安全停止

## ⚠️ 注意事项

1. **网络连接**: 需要网络访问Wikipedia API
2. **运行时间**: 24小时完整进化需要稳定环境
3. **后台运行**: 推荐使用`nohup`或`screen`/`tmux`
4. **日志监控**: 可通过`tail -f evolution.log`查看

## 🌐 网络问题排查

如果系统提示"网络不可用"，可能原因和解决方案：

### 自动网络检测

系统会自动检测网络环境并选择合适的数据源：

| 网络模式 | 数据源 | 适用环境 |
|----------|--------|----------|
| 国际模式 | Wikipedia API | 可访问国际网络 |
| 中国模式 | HF镜像 + 百度百科 | 中国大陆 |
| 离线模式 | 本地缓存 | 无网络连接 |

### 中国大陆用户 🇨🇳

系统已内置中国网络源支持：

**可用数据源**：
- **HF镜像** (`hf-mirror.com`) - Hugging Face 镜像站
- **百度百科** - 中文知识库
- **中文数据集** - Alpaca中文、Belle、MOSS等

**支持的数据集**：
```python
# 中文指令数据
"shibing624/alpaca-zh"      # 中文Alpaca
"BelleGroup/train_0.5M_CN"  # Belle中文
"fnlp/moss-002-sft-data"    # MOSS数据

# 问答数据
"THUDM/webglm-qa"           # WebGLM问答
"suolyer/webqa"             # 网页问答

# 通用文本
"pleisto/wikipedia-cn"      # 中文维基百科
```

**手动指定中国模式**：
```bash
# 设置环境变量强制使用中国源
export HF_ENDPOINT=https://hf-mirror.com
PYTHONPATH=. python3 start_24h_evolution.py
```

### 常见原因
1. **代理/VPN未配置**: 系统网络请求未走代理
2. **防火墙限制**: 企业/学校网络限制外网访问
3. **SSL证书问题**: 某些网络环境下证书验证失败
4. **DNS解析问题**: 无法解析域名

### 解决方案

```bash
# 方案1: 设置代理环境变量
export HTTP_PROXY="http://127.0.0.1:7890"
export HTTPS_PROXY="http://127.0.0.1:7890"
PYTHONPATH=. python3 start_24h_evolution.py

# 方案2: 测试网络连接
curl -I https://hf-mirror.com
curl -I https://www.baidu.com

# 方案3: 使用系统代理 (macOS)
export ALL_PROXY=$(networksetup -getwebproxy Wi-Fi | grep "Server" | awk '{print $2}')
```

### 离线模式
即使网络不可用，系统也会进入**离线模式**继续运行：
- 使用本地缓存的知识
- 执行能力测试和心跳监控
- 等待网络恢复后自动重连

## 🛑 停止与人工干预

### 正常停止（保留自动重启能力）
```bash
# 按一次 Ctrl+C
# 系统会优雅停止并生成报告
```

### 强制停止（完全禁用自动重启）
```bash
# 连续按两次 Ctrl+C
# 或直接创建停止标志文件：
touch FORCE_STOP
```

当需要完全人工干预时，使用强制停止可以：
- ✅ 完全停止所有进程
- ✅ 禁用自动重启和恢复机制
- ✅ 创建 `FORCE_STOP` 文件作为持久标记

### 恢复自动重启
```bash
# 删除强制停止标志文件
rm FORCE_STOP

# 然后重新启动系统
PYTHONPATH=. python3 start_24h_evolution.py
```

## 📝 监控命令

```bash
# 查看实时日志
tail -f evolution.log

# 查看当前状态
cat evolution_24h_state.json | python3 -m json.tool

# 查看守护进程状态
cat survival_daemon_state.json | python3 -m json.tool
```

---

*文档版本: 1.0 | 最后更新: 2026-01-22*
