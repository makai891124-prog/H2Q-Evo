# H2Q-Evo AGI Mac Mini M4流式训练系统

这是一个专为Mac Mini M4优化的AGI训练基础设施，实现了4GB内存限制的流式训练，充分发挥边缘计算能力。

## 🚀 Mac Mini M4优化特性

- **4GB内存限制**: 严格控制内存使用，避免内存交换到硬盘
- **流式训练**: 单项流式结构，数据分块处理，不占用大量内存
- **边缘计算**: 充分利用Mac Mini M4的神经引擎和统一内存架构
- **实时监控**: 内置健康监控窗口，实时查看训练进度
- **自动优化**: 根据系统状态动态调整训练参数

## 📦 系统组件

### 1. Mac Mini流式训练系统 (`agi_mac_mini_streaming.py`)
- **流式数据加载器**: 分块加载数据，避免内存溢出
- **内存池管理**: 智能内存分配和回收
- **轻量级模型**: 针对4GB内存优化的模型架构
- **梯度累积**: 减少显存使用的小批量训练
- **自动内存清理**: 实时监控和清理内存

### 2. 健康监控窗口 (`agi_health_monitor.py`)
- **实时状态显示**: CPU、内存、磁盘使用率
- **训练进度监控**: 步骤数、损失值、效率指标
- **系统健康检查**: 自动检测和报告问题
- **交互式界面**: 支持键盘操作的监控界面

### 3. Mac Mini启动器 (`start_mac_mini_training.py`)
- **系统要求检查**: 验证Mac Mini配置
- **流式训练启动**: 优化启动参数
- **后台监控**: 自动启动健康监控窗口
- **优雅关闭**: 安全停止所有组件

## 💻 Mac Mini M4硬件优化

### 内存管理策略
- **目标内存**: 4GB以内使用
- **流式处理**: 数据分块加载处理
- **内存池**: 预分配和重复使用内存
- **垃圾回收**: 主动触发内存清理

### CPU优化
- **多核心利用**: 自动检测和使用所有CPU核心
- **线程池**: 控制并发线程数量
- **亲和性设置**: 优化CPU缓存使用

### 存储优化
- **SSD缓存**: 利用高速SSD进行数据缓存
- **压缩存储**: 自动压缩检查点和备份
- **智能预取**: 预测性数据加载

## 🏃‍♂️ 快速开始

### 1. 系统检查
```bash
python start_mac_mini_training.py --check-only
```

### 2. 启动完整流式训练系统
```bash
python start_mac_mini_training.py
```

### 3. 仅启动监控窗口
```bash
python start_mac_mini_training.py --monitor-only
```

### 4. 后台启动（无监控窗口）
```bash
python start_mac_mini_training.py --no-monitor
```

## 📊 监控和状态

### 实时监控文件
- `mac_mini_streaming_status.json`: 流式训练状态
- `agi_mac_mini_status.json`: 系统运行状态
- `agi_mac_mini_report.json`: 详细系统报告

### 监控窗口操作
- **Q**: 退出监控
- **R**: 刷新数据
- **C**: 清屏

### 性能指标
- **训练步骤**: 当前训练步数
- **最佳损失**: 历史最佳损失值
- **内存使用**: 实时内存占用
- **流式效率**: 内存使用效率评分

## ⚙️ 配置参数

### 内存配置
```python
max_memory_gb = 4.0          # 最大内存使用4GB
memory_buffer_gb = 0.5       # 0.5GB缓冲区
streaming_batch_size = 1     # 流式批次大小
micro_batch_size = 1         # 微批次大小
```

### 训练配置
```python
gradient_accumulation_steps = 4  # 梯度累积步数
data_chunk_size = 100           # 数据块大小
max_cached_chunks = 2           # 最大缓存块数
```

### 监控配置
```python
update_interval = 2             # 监控更新间隔（秒）
resource_check_interval = 30    # 资源检查间隔（秒）
```

## 🔧 故障排除

### 内存不足
- 检查系统内存使用情况
- 减少`data_chunk_size`参数
- 增加`gradient_accumulation_steps`

### 训练缓慢
- 检查CPU使用率
- 调整`num_worker_threads`参数
- 启用`cpu_affinity`

### 监控窗口问题
- 确保终端支持curses
- 使用`--no-monitor`参数启动
- 检查Python curses模块安装

## 📈 性能优化建议

### 内存优化
1. 定期清理临时文件
2. 监控内存泄漏
3. 调整数据块大小

### CPU优化
1. 避免过度线程化
2. 利用多核心优势
3. 优化数据预处理

### 存储优化
1. 使用SSD存储
2. 定期清理旧检查点
3. 启用数据压缩

## 🔄 系统架构

```
┌─────────────────────────────────────────────────────┐
│                Mac Mini M4流式训练系统                │
│                start_mac_mini_training.py            │
└─────────────────────┬─────────────────────────────────┘
                      │
           ┌──────────┴──────────┐
           │                     │
┌──────────▼─────────┐ ┌─────────▼──────────┐
│   流式训练系统      │ │    健康监控窗口     │
│agi_mac_mini_streaming│ │agi_health_monitor │
└──────────┬─────────┘ └─────────┬──────────┘
           │                     │
           └──────────┬──────────┘
                      │
           ┌──────────▼──────────┐
           │                     │
┌──────────▼─────────┐ ┌─────────▼──────────┐
│   训练基础设施      │ │    检查点系统      │
│agi_training_infrastructure│ │agi_checkpoint_system │
└──────────┬─────────┘ └─────────┬──────────┘
           │                     │
           └──────────┬──────────┘
                      │
           ┌──────────▼──────────┐
           │   容错和恢复系统     │
           │agi_fault_tolerance │
           └─────────────────────┘
```

## 🛡️ 安全和稳定

### 自动恢复
- 内存不足时自动清理
- 训练发散时回滚检查点
- 网络错误时重试操作

### 数据保护
- 自动备份重要数据
- 检查点定期保存
- 优雅关闭保证数据完整性

### 资源控制
- CPU使用率限制
- 内存使用监控
- 磁盘空间管理

## 📝 更新日志

### v2.0.0 - Mac Mini M4优化版
- ✨ 全新流式训练架构
- 🧠 4GB内存限制优化
- 📊 实时健康监控窗口
- 🔄 自动参数调整
- 💾 智能内存管理

## 🤝 贡献

欢迎提交问题和改进建议！

## 📄 许可证

本项目采用MIT许可证。