import torch
import torch.nn as nn
from torch.utils.data import DataLoader, Dataset

from h2q_project.trainer import Trainer

# Define a dummy dataset
class DummyDataset(Dataset):
    def __init__(self, length):
        self.length = length

    def __len__(self):
        return self.length

    def __getitem__(self, idx):
        return torch.randn(10), torch.randint(0, 2, (1,)).item()  # Example input and label

# Define a dummy model
class DummyModel(nn.Module):
    def __init__(self):
        super().__init__()
        self.linear = nn.Linear(10, 2)

    def forward(self, x):
        return self.linear(x)


def main():
    # Hyperparameters
    epochs = 10
    batch_size = 32
    learning_rate = 0.001
    device = "cuda" if torch.cuda.is_available() else "cpu"

    # DataLoaders
    train_dataset = DummyDataset(1000)
    val_dataset = DummyDataset(200)
    train_dataloader = DataLoader(train_dataset, batch_size=batch_size, shuffle=True)
    val_dataloader = DataLoader(val_dataset, batch_size=batch_size, shuffle=False)

    # Model, Optimizer, Loss
    model = DummyModel().to(device)
    optimizer = torch.optim.Adam(model.parameters(), lr=learning_rate)
    loss_fn = nn.CrossEntropyLoss()

    # Trainer
    trainer = Trainer(
        model=model,
        train_dataloader=train_dataloader,
        val_dataloader=val_dataloader,
        optimizer=optimizer,
        loss_fn=loss_fn,
        device=device
    )

    # Train
    trainer.train(epochs)

if __name__ == "__main__":
    main()
