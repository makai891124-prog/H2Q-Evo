#!/usr/bin/env python3
"""
è®­ç»ƒæ—¶é—´è¯Šæ–­å·¥å…·
è¯Šæ–­ä¸ºä»€ä¹ˆè®¡åˆ’10å°æ—¶è®­ç»ƒåªéœ€è¦30åˆ†é’Ÿ
"""

import json
from pathlib import Path

SCRIPT_DIR = Path(__file__).resolve().parent

def main():
    print("=" * 70)
    print("ğŸ” è®­ç»ƒæ—¶é—´å¼‚å¸¸è¯Šæ–­")
    print("   è®¡åˆ’: 10å°æ—¶  |  å®é™…: ~30åˆ†é’Ÿ  |  å·®å¼‚: 20å€")
    print("=" * 70)
    
    # 1. æ£€æŸ¥æ•°æ®é›†å¤§å°
    print("\nğŸ“Š [é—®é¢˜1] æ•°æ®é›†è§„æ¨¡æ£€æŸ¥:")
    benchmark_dir = SCRIPT_DIR / 'benchmark_data'
    if benchmark_dir.exists():
        for f in benchmark_dir.rglob('*.json'):
            with open(f) as fp:
                data = json.load(fp)
                if isinstance(data, list):
                    count = len(data)
                else:
                    count = len(data.get('samples', data))
                print(f"   {f.name}: {count} samples")
                
                # é—®é¢˜: æ ·æœ¬é‡å¤ªå°
                if count < 1000:
                    print(f"   âš ï¸  è­¦å‘Š: æ ·æœ¬é‡è¿‡å°! çœŸå®è®­ç»ƒé€šå¸¸éœ€è¦ 10ä¸‡+ æ ·æœ¬")
    
    # 2. åˆ†æè®­ç»ƒä»£ç ä¸­çš„é‡‡æ ·é€»è¾‘
    print("\nğŸ“Š [é—®é¢˜2] æ¯Epoché‡‡æ ·é‡åˆ†æ:")
    
    # ä»ä»£ç åˆ†æ:
    # train_epoch() ä¸­:
    #   for dataset in self.datasets.values():
    #       samples = dataset.get_sample_batch(batch_size // len(self.datasets))
    # 
    # å¦‚æœ batch_size=16, datasetsæœ‰2ä¸ª, åˆ™æ¯ä¸ªæ•°æ®é›†åªé‡‡æ · 8 ä¸ªæ ·æœ¬
    # æ¯epochåªå¤„ç† 16 ä¸ªæ ·æœ¬!
    
    print("   ä»£ç åˆ†æ:")
    print("   - batch_size = 16")
    print("   - datasetsæ•°é‡ = 2 (MMLU, GSM8K)")
    print("   - æ¯æ•°æ®é›†é‡‡æ · = batch_size // 2 = 8")
    print("   - æ¯epochæ€»æ ·æœ¬ = 16 ä¸ª")
    print("   âš ï¸  è­¦å‘Š: æ¯epochåªå¤„ç†16ä¸ªæ ·æœ¬, è¿œä½äºæ­£å¸¸çš„500-1000ä¸ª!")
    
    # 3. æ£€æŸ¥å®é™…è®­ç»ƒçŠ¶æ€
    print("\nğŸ“Š [é—®é¢˜3] å®é™…è®­ç»ƒé‡ç»Ÿè®¡:")
    state_file = SCRIPT_DIR / 'agi_models' / 'evolution_system_state.json'
    if state_file.exists():
        with open(state_file) as f:
            state = json.load(f)
        
        generations = state.get('generation', 0)
        total_epochs = state.get('total_epochs', 0)
        
        # å®é™…å¤„ç†çš„æ ·æœ¬æ•°
        samples_per_epoch = 16  # ä»ä»£ç åˆ†æå¾—å‡º
        total_samples = total_epochs * samples_per_epoch
        
        print(f"   å®Œæˆä»£æ•°: {generations}")
        print(f"   æ€»Epochs: {total_epochs}")
        print(f"   æ¯Epochæ ·æœ¬: {samples_per_epoch}")
        print(f"   æ€»å¤„ç†æ ·æœ¬: {total_samples:,}")
        
        # å¯¹æ¯”æ­£å¸¸è®­ç»ƒ
        # æ­£å¸¸10å°æ—¶è®­ç»ƒ, å‡è®¾æ¯ç§’å¤„ç†50æ ·æœ¬
        # 10 * 3600 * 50 = 1,800,000 æ ·æœ¬
        normal_samples = 10 * 3600 * 50
        ratio = total_samples / normal_samples * 100
        
        print(f"\n   æ­£å¸¸10å°æ—¶é¢„æœŸæ ·æœ¬: ~{normal_samples:,}")
        print(f"   å®é™…/é¢„æœŸæ¯”: {ratio:.4f}%")
        print(f"   âš ï¸  å®é™…è®­ç»ƒé‡åªæœ‰æ­£å¸¸çš„ {ratio:.2f}%!")
    
    # 4. æ ¹æœ¬åŸå› åˆ†æ
    print("\n" + "=" * 70)
    print("ğŸš¨ æ ¹æœ¬åŸå› åˆ†æ")
    print("=" * 70)
    
    print("""
    é—®é¢˜ #1: æ•°æ®é›†è¿‡å°
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - å½“å‰: 500ä¸ªåˆæˆMMLUæ ·æœ¬ + 200ä¸ªåˆæˆGSM8Kæ ·æœ¬
    - åº”è¯¥: 10ä¸‡+ çœŸå®æ ·æœ¬
    - å½±å“: æ¨¡å‹æ— æ³•å­¦åˆ°çœŸå®çš„çŸ¥è¯†åˆ†å¸ƒ
    
    é—®é¢˜ #2: Epochå®šä¹‰é”™è¯¯  
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - å½“å‰: æ¯epochåªéšæœºé‡‡æ ·16ä¸ªæ ·æœ¬
    - åº”è¯¥: æ¯epochéå†å®Œæ•´æ•°æ®é›†
    - å½±å“: å¤§éƒ¨åˆ†æ•°æ®ä»æœªè¢«è®­ç»ƒè¿‡
    
    é—®é¢˜ #3: è®­ç»ƒå¾ªç¯å¤ªæµ…
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    - å½“å‰: 20ä»£ Ã— 30epoch = 600ä¸ª"epoch"
    - å®é™…: 600 Ã— 16 = 9,600 ä¸ªæ ·æœ¬å¤„ç†
    - åº”è¯¥: è‡³å°‘å¤„ç† 100ä¸‡+ æ ·æœ¬
    
    ç»“è®º: è¿™ä¸æ˜¯å¹¶è¡ŒåŒ–æ•ˆæœï¼Œæ˜¯è½¯ä»¶è®¾è®¡ç¼ºé™·ï¼
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    è®­ç»ƒç³»ç»Ÿå­˜åœ¨"ä¼ªè®­ç»ƒ"é—®é¢˜:
    1. å£°ç§°è®­ç»ƒäº†600ä¸ªepoch
    2. ä½†æ¯ä¸ªepochåªå¤„ç†16ä¸ªæ ·æœ¬
    3. æ€»è®¡åªå¤„ç†äº† ~10,000 ä¸ªæ ·æœ¬
    4. ç›¸å½“äºçœŸæ­£è®­ç»ƒçš„ 0.5% ä¸åˆ°
    
    è¿™å±äº"ä½œå¼Š"ç±»é—®é¢˜ï¼Œå‡†ç¡®ç‡æå‡ä¸»è¦æ¥è‡ª:
    - éšæœºæ³¢åŠ¨
    - å¯¹æå°æ•°æ®é›†çš„è¿‡æ‹Ÿåˆ
    - è€ŒéçœŸæ­£çš„çŸ¥è¯†å­¦ä¹ 
    """)
    
    # 5. ä¿®å¤å»ºè®®
    print("=" * 70)
    print("âœ… ä¿®å¤å»ºè®®")
    print("=" * 70)
    print("""
    1. ä½¿ç”¨å®Œæ•´Epochéå†:
       for batch in DataLoader(dataset, batch_size=32, shuffle=True):
           # è®­ç»ƒå®Œæ•´æ•°æ®é›†
    
    2. å¢åŠ æ•°æ®é›†è§„æ¨¡:
       - ä½¿ç”¨çœŸå®çš„MMLU/GSM8Kæ•°æ®é›†
       - ç›®æ ‡: 10ä¸‡+ æ ·æœ¬
    
    3. å¢åŠ è®­ç»ƒè¿­ä»£:
       - ç›®æ ‡: æ¯ä¸ªæ ·æœ¬è‡³å°‘è¢«è®­ç»ƒ10æ¬¡
       - 100,000æ ·æœ¬ Ã— 10æ¬¡ = 1,000,000 æ ·æœ¬å¤„ç†
    
    4. æ·»åŠ è®­ç»ƒæ—¶é—´è¿½è¸ª:
       - è®°å½•å®é™…è®­ç»ƒæ—¶é—´
       - è®¡ç®—æ ·æœ¬/ç§’ååé‡
       - é˜²æ­¢"ä¼ªè®­ç»ƒ"
    """)

if __name__ == "__main__":
    main()
