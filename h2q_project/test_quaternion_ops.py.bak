import pytest
import numpy as np
from h2q_project.quaternion_ops import quaternion_multiply, quaternion_conjugate, quaternion_norm, quaternion_normalize, quaternion_to_rotation_matrix


def test_quaternion_multiply():
    q1 = np.array([1, 0, 0, 0])
    q2 = np.array([0, 1, 0, 0])
    result = quaternion_multiply(q1, q2)
    expected = np.array([0, 1, 0, 0])
    assert np.allclose(result, expected)

    q1 = np.array([0, 1, 0, 0])
    q2 = np.array([0, 0, 1, 0])
    result = quaternion_multiply(q1, q2)
    expected = np.array([0, 0, 0, 1])
    assert np.allclose(result, expected)

    q1 = np.array([0.707, 0.707, 0, 0])
    q2 = np.array([0.707, 0, 0.707, 0])
    result = quaternion_multiply(q1, q2)
    expected = np.array([0.5, 0.5, 0.5, 0.5])
    assert np.allclose(result, expected)


def test_quaternion_conjugate():
    q = np.array([1, 2, 3, 4])
    result = quaternion_conjugate(q)
    expected = np.array([1, -2, -3, -4])
    assert np.allclose(result, expected)


def test_quaternion_norm():
    q = np.array([1, 2, 3, 4])
    result = quaternion_norm(q)
    expected = np.sqrt(1 + 4 + 9 + 16)
    assert np.isclose(result, expected)


def test_quaternion_normalize():
    q = np.array([1, 2, 3, 4])
    norm = np.sqrt(1 + 4 + 9 + 16)
    expected = np.array([1, 2, 3, 4]) / norm
    result = quaternion_normalize(q)
    assert np.allclose(result, expected)


def test_quaternion_to_rotation_matrix():
    q = np.array([1, 0, 0, 0])
    result = quaternion_to_rotation_matrix(q)
    expected = np.eye(3)
    assert np.allclose(result, expected)

    q = np.array([0, 1, 0, 0])  # 180 degree rotation around x-axis
    expected = np.array([
        [1, 0, 0],
        [0, -1, 0],
        [0, 0, -1]
    ])
    result = quaternion_to_rotation_matrix(q)
    assert np.allclose(result, expected)